# Thunderbird Theme Builder

The Theme Builder allows to create themes easily by parsing a config file and generating
an XPI file from it. It can also append a custom css file for theme experiment settings.

## Installation

`npm install -D https://github.com/artrz/thunderbird-theme-builder`

## Quick start

Run `npx tbtb init` to create the base files:

 - src/themeConfig.js - Where the colors are defined.
 - src/themeCustomStyles.scss - To further customization.
 - src/build.js - Script to build the theme.

## Configuration

### themeConfig.js

This file contains an object with three properties: `color_scheme`, `theme_colors` and `theme_experiment_colors`.
The values from the `color_scheme` are inserted as `theme_colors` and `theme_experiment_colors`.
Besides replacing the key, the `color_scheme` is also added as theme-experiment colors so they can be on the style file for further customization.

```js
module.exports = {
    // This is where the custom colors are defined. You can use any string as key name.
    // The colors defined here will be also added as css variables, prefixed with `--`.
    color_scheme: {
        color_foo: '#2E3440', // Will be available as --color_foo
        color_bar: '#3B4252', // Will be available as --color_bar
        ...
    },

    // This is where the theme colors are configured. Use the color names from the `color_scheme` property.
    // All the available elements are inside the autogenerated file.
    theme_colors: {
        ...
        frame: 'color_foo',
        frame_inactive: 'color_bar',
        popup: 'color_foo',
        ...
    },

    // Besides configuring the available elements it's also possible to override variables used in the application. This is where you can override the values. Find them using the `developer toolbox`.
    theme_experiment_colors: {
        ...
        '--primary-color': 'color_foo',
        '--button-primary-text-color': 'color_bar',
        ...
    },

    // Using the images property it's possible to configure images to include in the theme.
    // For this to work the assets directory must be configured on the build properties.
    images: {
        theme_frame: 'frame_image.png',
    }
};
```

### themeCustomStyles.scss

This is an empty file where you can add your custom styles.
The theme builder supports CSS, SCSS and SASS files. If you prefer to use a different file type, besides changing the file extension
you need to update the filename in the build settings.
It's also possible to use custom images as part of the styles.

```css
body {
  background-color: var(--color_foo); /* defined in color_scheme.color_foo */
}
.overridden-class {
    background-image: url('my_file.png');
}
```

### build.js

Use this file to build the theme. Easiest way is by adding a NPM script in package.json to run it:

```json
{
    "scripts": {
        "build": "node src/build.js"
    }
}
```


## Theme properties

### Images

As previously mentioned there are two ways to use images: setting images as resources for the theme and using them as part of the custom styling.
After configuring the assets directory and placing the images there, all of them are going to be copied to the root directory of the theme
so to refer to them it's only required to use the filename.

### Default values

When building the theme there are some properties required in order to create the theme's manifest file.
Not explicitly configured properties are going to be obtained from the package.json file or set with default values.

```js
// Default values. themePackage refers to the package.json contents.
{
    manifest_version: 2, // Not configurable, v3 is supported by Thunderbird 128+.
    name: themePackage.displayName ?? themePackage.name,
    version: themePackage.version,
    description: themePackage.description,
    author: themePackage.author?.name,
    homepage_url: themePackage.author?.url,
    browser_specific_settings: {
        gecko: {
            id: `${themePackage.name}@addons.thunderbird.net`,
            strict_min_version: '115.0',
        },
    },
}
...
```

Even though any property can be defined/overridden it's suggested to configure the package.json file
and let the package gather most of the data from there.

See [src/manifestGenerator.ts](src/manifestGenerator.ts) for the actual implementation.

### Configuring / overriding properties

There are two values which cannot be obtained from the default package.json structure:
the theme's id and the minimum required Thunderbird version.
The following object shows how to configure them:

```js
{
    themeId: 'customthemeid@domain.ext' // Email or UUID as per Thunderbird requirements.
    thunderbirdMinVersion: '128' // Configures strict_min_version.
}
```

There are two ways to set/override the theme properties, by adding the values inside package.json
or by setting them as a parameter in the build script.

#### Configuring in package.json

Properties must be added inside `extra.thunderbird`, e.g.:

```json
{
    "extra": {
        "thunderbird": {
            "themeId": "customthemeid@domain.ext",
            "thunderbirdMinVersion": "128",
        }
    }
}
```

#### Setting theme properties as parameter

Add an object containing the properties to configure as second parameter of the build function call, e.g.:

```js
// build.js
...
build(theme, {
    themeId: 'customthemeid@domain.ext',
    thunderbirdMinVersion: '128',
});
```

#### Full configuration

The default full configuration used when building the theme is:

```js
{
    name: undefined,
    version: undefined,
    themeId: undefined,
    thunderbirdMinVersion: undefined,
    stylesheet: undefined,
    author: {
        name: undefined,
        url: undefined,
    },
    srcDir: 'src', // This defines the source location.
    outDir: 'build', // This defines where the XPI file is going to be placed.
    assetsDir: undefined, // Define the directory containing the theme images.
}
```

The most common case would be to use the following object as configuration:

```js
{
    thunderbirdMinVersion: '128.0',
    stylesheet: 'themeCustomStyles.scss',
    assetsDir: 'src/assets',
}
```


## Build

The package exposes a single function that needs to be called to build the theme. The simplest way to
generate the theme is by running the build.js file. If the build script was added as previously suggested,
after configuring the theme colors and style file just run `npm run build` to generate the theme.
The XPI file will be created in the directory configured in `outDir` which is './build' by default.

# Thunderbird Theme Builder

The Theme Builder allows to create themes easily by parsing a config file and generating
an XPI file from it. It can also append a custom css file for theme experiment settings.

## Installation

`npm install -D https://github.com/artrz/thunderbird-theme-builder`

## Quick start

Run `npx tbtb init` to create the base files:

 - src/themeConfig.js - Where the colors are defined.
 - src/themeCustomStyles.scss - To further customization.
 - src/build.js - Script to build the theme.

## Configuration

### themeConfig.js

This file contains an object with three properties: `color_scheme`, `theme_colors` and `theme_experiment_colors`.
The values from the `color_scheme` are inserted as `theme_colors` and `theme_experiment_colors`. Besides replacing the key, the `color_scheme` is also added as
theme-experiment colors so they can be on the style file for further customization.

```js
module.exports = {
    // This is where the custom colors are defined. You can use any string as key name.
    // The colors defined here will be also added as css variables with `--` appended.
    color_scheme: {
        color_foo: '#2E3440', // Will be available as --color_foo
        color_bar: '#3B4252', // Will be available as --color_bar
        ...
    },

    // This is where the theme colors are configured. Use the color names from the `color_scheme` property.
    // All the available elements are inside the autogenerated file.
    theme_colors: {
        ...
        frame: 'color_foo',
        frame_inactive: 'color_bar',
        popup: 'color_foo',
        ...
    },

    // Besides configuring the available elements it's also possible to override variables used in the application. This is where you can override the values. Find them using the `developer toolbox`.
    theme_experiment_colors: {
        ...
        '--primary-color': 'color_foo',
        '--button-primary-text-color': 'color_bar',
        ...
    },
};
```

### themeCustomStyles.scss

This is an empty file where you can add your custom styles.
The theme builder supports CSS, SCSS and SASS files. If you prefer to use a different file type, besides changing the file extension
you need to update the filename on the building settings.

### build.js

Use this file to build the theme. Easiest way is by adding a NPM script in package.json to run it:

```json
{
    "scripts": {
        "build": "node src/build.js"
    }
}
```


## Theme properties

### Default values

When building the theme there are some properties required in order to create the theme's manifest file.
Not explicitly configured properties are going to be obtained from the package.json file or set with default values.

```js
// Default values. themePackage refers to the package.json contents.
{
    manifest_version: 2, // Not configurable, v3 is supported by Thunderbird 128+.
    name: themePackage.displayName ?? themePackage.name,
    version: themePackage.version,
    description: themePackage.description,
    author: themePackage.author?.name,
    homepage_url: themePackage.author?.url,
    browser_specific_settings: {
        gecko: {
            id: `${themePackage.name}@addons.thunderbird.net`,
            strict_min_version: '115.0',
        },
    },
}
...
```

Even though any property can be defined/overridden it's suggested to configure the package.json file
and let the package gather most of the data from there.

See [src/manifestGenerator.ts](src/manifestGenerator.ts) for the actual implementation.

### Configuring / overriding properties

The following object contains the minimum properties to compliment what cannot be obtained from the standard
package.json structure:

```js
{
    themeId: 'customthemeid@domain.ext' // Email or UUID as Thunderbird requirement.
    thunderbirdMinVersion: '128' // Configures strict_min_version.
    stylesheet: 'style.css' // The style filename.
}
```

There are two ways to compliment / override the theme properties, by adding the values inside package.json
or by setting them as a parameter on the build script.

#### Configuring in package.json

Properties must be added inside `extra.thunderbird`, e.g.:

```json
{
    "extra": {
        "thunderbird": {
            "themeId": "customthemeid@domain.ext",
            "thunderbirdMinVersion": "128",
            "stylesheet": "style.css"
        }
    }
}
```

#### Setting theme properties as parameter

An object containing all the properties to configure can be passed a parameter to the build function, e.g.:

```js
// build.js
...
build(theme, {
    themeId: 'customthemeid@domain.ext',
    thunderbirdMinVersion: '128',
    stylesheet: 'style.css',
});
```

#### Full configuration

```js
{
    name: undefined,
    version: undefined,
    themeId: undefined,
    thunderbirdMinVersion: undefined,
    stylesheet: undefined,
    author: {
        name: undefined,
        url: undefined,
    },
    srcDir: 'src', // This defines the source location.
    outDir: 'build', // This defines where the XPI file is going to be placed.
}
```

## Build

The package exposes a single function that needs to be called to build the theme. The simplest way to
generate the theme is by running the build.js file. If the build script was added as previously suggested,
after configuring the theme colors and style file just run `npm run build` to generate the theme.
The XPI file will be created in the directory configured in `outDir` which is './build' by default.
